{"ast":null,"code":"var _jsxFileName = \"/Users/hiuchunchan/Downloads/4601project/sun/sunpo/src/App.js\";\n// import React from 'react';\nimport logo from \"./logo.svg\";\nimport './App.css'; // import Content from './Content';\n// import Try from './notused/Try';\n\nimport Login from './Login';\nimport TableList from './Table';\nimport Menu from './Menu';\nimport Bills from './Bills';\nimport Home from './Home';\nimport { withRouter } from 'react-router-dom';\nimport React, { useState, useEffect } from 'react';\nimport { Redirect } from 'react-router-dom'; // import { BrowserRouter as Router, Route } from 'react-router-dom';\n// import logic from './logic';\n\nimport '../node_modules/bootstrap/dist/css/bootstrap.min.css';\nimport $ from 'jquery';\nimport { BrowserRouter as Router, Switch, Route, Link } from \"react-router-dom\"; // function requireAuth(nextState, replace, next) {\n//   if (!this.state.isLoggedIn) {\n//     replace({\n//       pathname: \"/login\",\n//       state: {nextPathname: nextState.location.pathname}\n//     });\n//   }\n//   next();\n// }\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoggedIn: false,\n      userId: '',\n      username: '',\n      password: '',\n      login_fail: 'WELCOME!',\n      user_type: '',\n      active_function: '',\n      position: '' // transinfo: [],\n      // tableinfo: [],\n\n    };\n    this.usernameChange = this.usernameChange.bind(this);\n    this.passwordChange = this.passwordChange.bind(this);\n    this.LoginClick = this.LoginClick.bind(this);\n    this.LogoutClick = this.LogoutClick.bind(this);\n    this.OrderClick = this.OrderClick.bind(this);\n    this.TableClick = this.TableClick.bind(this);\n    this.PaybillsClick = this.PaybillsClick.bind(this);\n    this.ForecastClick = this.ForecastClick.bind(this);\n    this.BackTableClick = this.BackTableClick.bind(this);\n    this.PlaceOrderClick = this.PlaceOrderClick.bind(this);\n    this.PayClick = this.PayClick.bind(this);\n  }\n\n  render() {\n    const isLoggedIn = this.state.isLoggedIn;\n    let title, current_page, login_page, menu_page, tablelist, nav, bills; // let routes = '';\n\n    if (isLoggedIn) {\n      title = '';\n      nav = React.createElement(\"div\", {\n        class: \"nav_bar\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 68\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        class: \"fas fa-home\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 69\n        },\n        __self: this\n      }, \" SUN PO\"), React.createElement(\"ul\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 70\n        },\n        __self: this\n      }, React.createElement(\"li\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        class: \"fas fa-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71\n        },\n        __self: this\n      }, \" \", this.state.username)), React.createElement(\"li\", {\n        onClick: this.OrderClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        class: \"function_btn fas fa-shopping-bag\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73\n        },\n        __self: this\n      }, \"\\u9EDE\\u9910\")), React.createElement(\"li\", {\n        onClick: this.PaybillsClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 75\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        class: \"function_btn fas fa-money-bill-wave\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 75\n        },\n        __self: this\n      }, \" \\u67E5\\u95B1/\\u7D50\\u8CEC\")), React.createElement(\"li\", {\n        onClick: this.ForecastClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 76\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        class: \"function_btn fas fa-atom\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 76\n        },\n        __self: this\n      }, \" \\u92B7\\u91CF\\u9810\\u6E2C\")), React.createElement(\"li\", {\n        onClick: this.LogoutClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 77\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        class: \"function_btn fas fa-power-off\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 77\n        },\n        __self: this\n      }, \" \\u767B\\u51FA\"))));\n      menu_page = React.createElement(Menu, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 80\n        },\n        __self: this\n      });\n      bills = React.createElement(Bills, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81\n        },\n        __self: this\n      }); // tablelist = <TableList\n      // TableClick = {this.TableClick}\n      //                             payBills = {false}\n      //                             tableinfo={this.state.tableinfo}/>\n\n      tablelist = React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 86\n        },\n        __self: this\n      }, this.state.active_function); // routes = \n      //   <Router>\n      //   <Switch>\n      //               <Route path=\"/home\">\n      //                 <Home/>\n      //               </Route>\n      //               <Route path=\"/login\">\n      //                 <Home/>\n      //               </Route>\n      //               <Route path=\"/order\" onEnter={this.requireAuth}  >\n      //               <TableList \n      //                               // active_function={this.state.active_Function}\n      //                               TableClick = {this.TableClick}\n      //                               payBills = {false}\n      //                               tableinfo={this.state.tableinfo}\n      //                     />\n      //               </Route>\n      //               <Route path=\"/paybills\">\n      //               <TableList \n      //                               // active_function={this.state.active_Function}\n      //                               TableClick = {this.TableClick}\n      //                               payBills = {true}\n      //                               tableinfo={this.state.tableinfo}\n      //                     />\n      //               </Route>\n      //               <Route path=\"/forcast\">\n      //               </Route>\n      //                {/* <Route path=\"/menu\">\n      //               <Menu BackTableClick = {this.BackTableClick}\n      //                         PlaceOrderClick = {this.PlaceOrderClick}\n      //                         // tableNumber = {tableNumber}\n      //                         userId={this.state.userId}\n      //   />,\n      //               </Route>  */}\n      //            </Switch>  \n      //  </Router>   \n    } else {\n      title = React.createElement(\"div\", {\n        id: \"logo_title\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127\n        },\n        __self: this\n      }, \"SUN PO\");\n      login_page = React.createElement(Login, {\n        username: this.state.username,\n        password: this.state.password // position={this.state.position}\n        ,\n        onUsernameChange: this.usernameChange,\n        onPasswordChange: this.passwordChange,\n        LoginClick: this.LoginClick,\n        login_fail: this.state.login_fail,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128\n        },\n        __self: this\n      });\n    }\n\n    return (\n      /* <Link to=\"/login\">login</Link>\n      <Link to=\"/logout\">logout</Link> \n      <Link to=\"/order\">order</Link>\n      <Link to=\"/paybills\">paybills</Link>\n      <Link to=\"/forecast\">forecast</Link>\n      <Link exact to=\"/\">Home</Link>   */\n      React.createElement(\"div\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148\n        },\n        __self: this\n      }, title, nav, login_page, tablelist)\n    );\n  } // requireAuth(nextState, replace)\n  // {\n  // if(!this.state.isLoggedIn) // pseudocode - SYNCHRONOUS function (cannot be async without extra callback parameter to this function)\n  // replace('/login');\n  // }\n\n\n  usernameChange(name) {\n    this.setState({\n      username: name\n    });\n  }\n\n  passwordChange(pass) {\n    this.setState({\n      password: pass\n    });\n  }\n\n  componentDidMount() {\n    if (localStorage.loggin === 'true') {\n      this.setState({\n        isLoggedIn: true,\n        username: localStorage.usrname,\n        position: localStorage.position,\n        userId: localStorage.userId\n      });\n      this.pageRefresh(localStorage.usrname, localStorage.password);\n    } // const script = document.createElement(\"script\");\n    // // script.async = true;\n    // script.src = \"https://kit.fontawesome.com/b99e675b6e.js\";\n    // document.head.appendChild(script);\n    //get transaction\n\n\n    $.ajax({\n      url: \"http://localhost:3001/gettransaction\",\n      method: \"GET\",\n      xhrFields: {\n        withCredentials: true\n      },\n      success: function (datas) {\n        if (datas.message === \"Login Success!\") {\n          alert(\"success\");\n        } // alert(datas.tran[0].products[0].name+\" \"+datas.tran[0].products[0].price+\" \"+datas.tran[0].products[0].originalPrice+\" \"+\n        // datas.tran[0].products[0].quantity+\" \"+datas.tran[0].products[0].custom[0]+\" \"+datas.tran[0].totalPrice+' '+\n        // datas.tran[0].tranId+\" \"+datas.tran[0].tableNumber+\" \"+datas.tran[0].transTime+\" \"+datas.tran[0].orderStatus+\" \"+datas.tran[0].seatTaken);\n\n\n        for (var i in datas.tran) {\n          if (datas.tran[i].orderStatus == \"proceeding\") {\n            this.setState({\n              transinfo: this.state.transinfo.concat({\n                \"tranId\": datas.tran[i].tranId,\n                \"userId\": datas.tran[i].userId,\n                \"products\": datas.tran[i].products,\n                \"totalPrice\": datas.tran[i].totalPrice,\n                \"tableNumber\": datas.tran[i].tableNumber,\n                \"orderStatus\": datas.tran[i].orderStatus,\n                \"transTime\": datas.tran[i].transTime,\n                \"seatTaken\": datas.tran[i].seatTaken\n              })\n            });\n          }\n        }\n      }.bind(this),\n      error: function (xhr, ajaxOptions, thrownError) {\n        alert(xhr.status);\n        alert(thrownError);\n      }\n    });\n    setTimeout(function () {\n      // this.state.transinfo[0].products.map((tran, index) => {\n      //     alert(tran.name+' '+tran.custom[0]);\n      // })\n      this.state.tableinfo.map((table, index) => {\n        this.state.transinfo.map((tran, i) => {\n          if (tran.tableNumber === table.tableNumber) {\n            let items = [...this.state.tableinfo];\n            let item = { ...items[index]\n            };\n            item.seatTaken = item.seatTaken + tran.seatTaken;\n            item.transaction = item.transaction.concat(tran.tranId);\n            items[index] = item;\n            this.setState({\n              tableinfo: items\n            });\n          }\n        });\n      });\n      this.state.tableinfo.map((table, index) => {\n        if (table.maxCap <= table.seatTaken) {\n          // alert(\"maxcap: \"+table.maxCap+\" seatTaken: \"+table.seatTaken);\n          let items = [...this.state.tableinfo];\n          let item = { ...items[index]\n          };\n          item.isFull = true;\n          items[index] = item;\n          this.setState({\n            tableinfo: items\n          });\n        }\n      });\n      this.state.tableinfo.map((table, index) => {\n        let items = [...this.state.tableinfo];\n        let item = { ...items[index]\n        };\n\n        if (table.isFull === true) {\n          item.tableColor = 'red';\n        } else if (table.isFull !== true && table.seatTaken > 0) {\n          item.tableColor = 'orange';\n        } else {\n          item.tableColor = 'palegreen';\n        }\n\n        items[index] = item;\n        this.setState({\n          tableinfo: items\n        }); // alert(table.tableNumber+' '+table.tableColor);\n\n        if (table.transaction && table.transaction.length > 0) {// alert(\"Table \"+table.tableNumber + \" has transaction\");\n          // alert(table.transaction[0]);\n        }\n      });\n    }.bind(this), 100);\n  }\n\n  pageRefresh(usrname, password) {\n    var url = \"http://localhost:3001/login\";\n    var userinfo = {\n      'username': usrname,\n      'password': password\n    };\n    $.ajax({\n      url: url,\n      method: \"POST\",\n      data: userinfo,\n      xhrFields: {\n        withCredentials: true\n      },\n      success: function (data) {\n        if (data.message === \"Login Success!\") {\n          this.setState({});\n        } else {\n          this.setState({\n            userId: '',\n            username: '',\n            password: '',\n            isLoggedIn: false,\n            login_fail: \"LOGIN FAILURE\"\n          });\n        }\n      }.bind(this),\n      error: function (xhr, ajaxOptions, thrownError) {\n        alert(xhr.status);\n        alert(thrownError);\n      }\n    });\n  }\n\n  LoginClick(e) {\n    if (this.state.username === '' || this.state.password === '') {\n      // alert('Please fill in all fields');\n      this.setState({\n        login_fail: 'PLEASE FILL IN ALL FIELDS!'\n      });\n    } else {\n      localStorage.setItem('usrname', this.state.username);\n      localStorage.setItem('password', this.state.password);\n      var loginInfo = {\n        \"username\": this.state.username,\n        \"password\": this.state.password\n      };\n      $.ajax({\n        url: \"http://localhost:3001/login\",\n        type: 'POST',\n        data: loginInfo,\n        xhrFields: {\n          withCredentials: true\n        },\n        // dataType: 'JSON',\n        success: function (data) {\n          if (data.message === \"Login Success!\") {\n            localStorage.setItem('loggin', 'true');\n            localStorage.setItem('position', data.position);\n            localStorage.setItem('userId', data.id); // alert(data.id);\n\n            this.setState({\n              isLoggedIn: true,\n              login_fail: 'WELCOME!',\n              position: data.position,\n              userId: localStorage.userId\n            });\n          } else {\n            this.setState({\n              username: '',\n              password: '',\n              isLoggedIn: false,\n              login_fail: \"LOGIN FAILURE\",\n              userId: ''\n            });\n          }\n        }.bind(this),\n        error: function (xhr, ajaxOptions, thrownError) {\n          alert(xhr.status);\n          alert(thrownError);\n        }\n      });\n    }\n\n    e.preventDefault(e);\n  }\n\n  LogoutClick() {\n    $.ajax({\n      url: \"http://localhost:3001/logout\",\n      method: \"GET\",\n      xhrFields: {\n        withCredentials: true\n      },\n      success: function (data) {\n        // clear stored user state after logout\n        localStorage.setItem('loggin', 'false');\n        localStorage.setItem('usrname', '');\n        localStorage.setItem('password', ''); // clear timer\n        // clearInterval(this.timerID);\n\n        this.setState({\n          username: '',\n          password: '',\n          isLoggedIn: false,\n          login_fail: \"SUCCESSFULLY LOGOUT!\"\n        });\n      }.bind(this),\n      error: function (xhr, ajaxOptions, thrownError) {\n        alert(xhr.status);\n        alert(thrownError);\n      }\n    });\n  }\n\n  OrderClick(e) {\n    this.setState({\n      // payBills: false,\n      active_function: React.createElement(TableList // active_function={this.state.active_Function}\n      , {\n        TableClick: this.TableClick,\n        payBills: '點餐' // tableinfo={this.state.tableinfo}\n        // tableNumber={this.state.tableNumber}\n        ,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 399\n        },\n        __self: this\n      })\n    });\n  }\n\n  TableClick(e, data) {\n    let tableNumber = '';\n    if (data[2] == '0') tableNumber = '10';else tableNumber = data[1];\n\n    if (data[0] == 1) {\n      this.setState({\n        active_function: React.createElement(Menu, {\n          BackTableClick: this.BackTableClick // AddFoodClick = {this.AddFoodClick}\n          // AddBtnClick = {this.AddBtnClick}\n          ,\n          PlaceOrderClick: this.PlaceOrderClick // addedList={this.state.addedList}\n          ,\n          tableNumber: tableNumber,\n          userId: this.state.userId,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 417\n          },\n          __self: this\n        }) // active_function: '',\n\n      });\n    } else if (data[0] == 2) {\n      this.setState({\n        active_function: React.createElement(Bills, {\n          BackTableClick: this.BackTableClick,\n          PayClick: this.PayClick,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 430\n          },\n          __self: this\n        })\n      });\n    }\n  }\n\n  PaybillsClick(e) {\n    this.setState({\n      // payBills: true,\n      active_function: React.createElement(TableList, {\n        TableClick: this.TableClick,\n        payBills: '結賬' // tableinfo={this.state.tableinfo}\n        // tableNumber={this.state.tableNumber}\n        ,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 441\n        },\n        __self: this\n      }) // active_function: <Menu/>,\n\n    });\n  }\n\n  ForecastClick(e) {\n    if (this.state.position == \"manager\") {\n      this.setState({\n        active_function: ''\n      });\n    } else {\n      alert(\"Permitted Action!\"); // this.props.history.push('/home/');\n      // return(\n      //   <Redirect to={{\n      //     pathname: '/home',\n      //     // state: { id: '123' }\n      // }} />\n      //   <Route>\n\n      return React.createElement(Redirect, {\n        to: \"/home\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 466\n        },\n        __self: this\n      }); // <Redirect path=\"/home\" />\n      // </Route>\n      // )\n    }\n  }\n\n  BackTableClick(e, data) {\n    // alert(data[0]);\n    if (data[0] == 1) this.setState({\n      active_function: React.createElement(TableList, {\n        TableClick: this.TableClick,\n        payBills: false,\n        tableinfo: this.state.tableinfo,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 480\n        },\n        __self: this\n      })\n    });else this.setState({\n      active_function: React.createElement(TableList, {\n        TableClick: this.TableClick,\n        payBills: true,\n        tableinfo: this.state.tableinfo,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 489\n        },\n        __self: this\n      })\n    });\n  }\n\n  PlaceOrderClick(e, data) {\n    // var confirmation = window.confirm('你確定要落單?');\n    // if(confirmation === true){\n    this.setState({\n      active_function: ''\n    }); // var a = e.target.id;\n    // alert(a);\n    // alert(\"place: \" +data);\n    // data.map(item => {\n    //   alert(item.name + \": $\"+item.price+\" quantity: \"+item.quantity+\" totalPrice: \"+item.totalPrice+\n    //   \" tableNumber: \"+item.tableNumber+\" transTime: \"+item.transTime+\" People: \"+item.seatTaken+\n    //   \" id: \"+item.id+\" custom: \")\n    //   item.custom.map(items => {\n    //     // alert(item.name + \": $\"+item.price+\" quantity: \"+item.quantity+\"custom: \"+items)\n    // alert(item.totalPrice+' '+item.tableNumber+' '+item.transTime+' '+item.orderStatus);\n    // })\n    // })\n    // }\n  }\n\n  PayClick(e) {\n    this.setState({\n      active_function: ''\n    });\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/hiuchunchan/Downloads/4601project/sun/sunpo/src/App.js"],"names":["Login","TableList","Menu","Bills","Home","withRouter","React","useState","useEffect","Redirect","$","BrowserRouter","Router","Switch","Route","Link","App","Component","constructor","props","state","isLoggedIn","userId","username","password","login_fail","user_type","active_function","position","usernameChange","bind","passwordChange","LoginClick","LogoutClick","OrderClick","TableClick","PaybillsClick","ForecastClick","BackTableClick","PlaceOrderClick","PayClick","render","title","current_page","login_page","menu_page","tablelist","nav","bills","name","setState","pass","componentDidMount","localStorage","loggin","usrname","pageRefresh","ajax","url","method","xhrFields","withCredentials","success","datas","message","alert","i","tran","orderStatus","transinfo","concat","tranId","products","totalPrice","tableNumber","transTime","seatTaken","error","xhr","ajaxOptions","thrownError","status","setTimeout","tableinfo","map","table","index","items","item","transaction","maxCap","isFull","tableColor","length","userinfo","data","e","setItem","loginInfo","type","id","preventDefault"],"mappings":";AAAA;;AAEA,OAAO,WAAP,C,CACA;AACA;;AACA,OAAOA,KAAP,MAAkB,SAAlB;AACA,OAAOC,SAAP,MAAsB,SAAtB;AACA,OAAOC,IAAP,MAAiB,QAAjB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,IAAP,MAAiB,QAAjB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,OAAOC,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,SAASC,QAAT,QAAyB,kBAAzB,C,CACA;AAEA;;AACA,OAAO,sDAAP;AACA,OAAOC,CAAP,MAAc,QAAd;AACA,SAASC,aAAa,IAAIC,MAA1B,EAAkCC,MAAlC,EAA0CC,KAA1C,EAAiDC,IAAjD,QAA6D,kBAA7D,C,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA,MAAMC,GAAN,SAAkBV,KAAK,CAACW,SAAxB,CAAiC;AAC/BC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AAEA,SAAKC,KAAL,GAAa;AACXC,MAAAA,UAAU,EAAE,KADD;AAEXC,MAAAA,MAAM,EAAE,EAFG;AAGXC,MAAAA,QAAQ,EAAE,EAHC;AAIXC,MAAAA,QAAQ,EAAE,EAJC;AAKXC,MAAAA,UAAU,EAAE,UALD;AAMXC,MAAAA,SAAS,EAAE,EANA;AAOXC,MAAAA,eAAe,EAAE,EAPN;AAQXC,MAAAA,QAAQ,EAAE,EARC,CASX;AACA;;AAVW,KAAb;AAYA,SAAKC,cAAL,GAAsB,KAAKA,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAAtB;AACA,SAAKC,cAAL,GAAsB,KAAKA,cAAL,CAAoBD,IAApB,CAAyB,IAAzB,CAAtB;AACA,SAAKE,UAAL,GAAkB,KAAKA,UAAL,CAAgBF,IAAhB,CAAqB,IAArB,CAAlB;AACA,SAAKG,WAAL,GAAmB,KAAKA,WAAL,CAAiBH,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKI,UAAL,GAAkB,KAAKA,UAAL,CAAgBJ,IAAhB,CAAqB,IAArB,CAAlB;AACA,SAAKK,UAAL,GAAkB,KAAKA,UAAL,CAAgBL,IAAhB,CAAqB,IAArB,CAAlB;AACA,SAAKM,aAAL,GAAqB,KAAKA,aAAL,CAAmBN,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKO,aAAL,GAAqB,KAAKA,aAAL,CAAmBP,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKQ,cAAL,GAAsB,KAAKA,cAAL,CAAoBR,IAApB,CAAyB,IAAzB,CAAtB;AACA,SAAKS,eAAL,GAAuB,KAAKA,eAAL,CAAqBT,IAArB,CAA0B,IAA1B,CAAvB;AACA,SAAKU,QAAL,GAAgB,KAAKA,QAAL,CAAcV,IAAd,CAAmB,IAAnB,CAAhB;AACD;;AAEDW,EAAAA,MAAM,GAAE;AACN,UAAMpB,UAAU,GAAG,KAAKD,KAAL,CAAWC,UAA9B;AACA,QAAIqB,KAAJ,EAAWC,YAAX,EAAyBC,UAAzB,EAAqCC,SAArC,EAAgDC,SAAhD,EAA2DC,GAA3D,EAAgEC,KAAhE,CAFM,CAGN;;AAEA,QAAI3B,UAAJ,EAAgB;AACdqB,MAAAA,KAAK,GAAG,EAAR;AACAK,MAAAA,GAAG,GAAG;AAAK,QAAA,KAAK,EAAC,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE;AAAI,QAAA,KAAK,EAAC,aAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADF,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAI;AAAK,QAAA,KAAK,EAAC,aAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAA2B,KAAK3B,KAAL,CAAWG,QAAtC,CAAJ,CADF,EAGE;AAAI,QAAA,OAAO,EAAE,KAAKW,UAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA8B;AAAG,QAAA,KAAK,EAAC,kCAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAA9B,CAHF,EAKE;AAAI,QAAA,OAAO,EAAE,KAAKE,aAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAiC;AAAG,QAAA,KAAK,EAAC,qCAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAAjC,CALF,EAME;AAAI,QAAA,OAAO,EAAE,KAAKC,aAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAiC;AAAG,QAAA,KAAK,EAAC,0BAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAAjC,CANF,EAOE;AAAI,QAAA,OAAO,EAAE,KAAKJ,WAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA+B;AAAG,QAAA,KAAK,EAAC,+BAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAA/B,CAPF,CAFF,CAAN;AAYAY,MAAAA,SAAS,GAAG,oBAAC,IAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAZ;AACAG,MAAAA,KAAK,GAAG,oBAAC,KAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAR,CAfc,CAgBZ;AACA;AACA;AACA;;AACAF,MAAAA,SAAS,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAM,KAAK1B,KAAL,CAAWO,eAAjB,CAAZ,CApBY,CAsBd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,KA3DD,MA4DI;AACFe,MAAAA,KAAK,GAAG;AAAK,QAAA,EAAE,EAAC,YAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAR;AACAE,MAAAA,UAAU,GAAG,oBAAC,KAAD;AACb,QAAA,QAAQ,EAAE,KAAKxB,KAAL,CAAWG,QADR;AAEb,QAAA,QAAQ,EAAE,KAAKH,KAAL,CAAWI,QAFR,CAGb;AAHa;AAIb,QAAA,gBAAgB,EAAE,KAAKK,cAJV;AAKb,QAAA,gBAAgB,EAAE,KAAKE,cALV;AAMb,QAAA,UAAU,EAAE,KAAKC,UANJ;AAOb,QAAA,UAAU,EAAE,KAAKZ,KAAL,CAAWK,UAPV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAb;AAUD;;AAED;AAEI;;;;;;AAMH;AAAK,QAAA,SAAS,EAAC,KAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACIiB,KADJ,EAEIK,GAFJ,EAGIH,UAHJ,EAKIE,SALJ;AARD;AAmBD,GA/H8B,CAgI/B;AACA;AACA;AACA;AACA;;;AAEAjB,EAAAA,cAAc,CAACoB,IAAD,EAAO;AACnB,SAAKC,QAAL,CAAc;AACZ3B,MAAAA,QAAQ,EAAE0B;AADE,KAAd;AAGD;;AAEDlB,EAAAA,cAAc,CAACoB,IAAD,EAAO;AACnB,SAAKD,QAAL,CAAc;AACZ1B,MAAAA,QAAQ,EAAE2B;AADE,KAAd;AAGD;;AAEDC,EAAAA,iBAAiB,GAAE;AACjB,QAAGC,YAAY,CAACC,MAAb,KAAwB,MAA3B,EAAkC;AAChC,WAAKJ,QAAL,CAAc;AACZ7B,QAAAA,UAAU,EAAE,IADA;AAEZE,QAAAA,QAAQ,EAAE8B,YAAY,CAACE,OAFX;AAGZ3B,QAAAA,QAAQ,EAAEyB,YAAY,CAACzB,QAHX;AAIZN,QAAAA,MAAM,EAAE+B,YAAY,CAAC/B;AAJT,OAAd;AAMA,WAAKkC,WAAL,CAAiBH,YAAY,CAACE,OAA9B,EAAuCF,YAAY,CAAC7B,QAApD;AACD,KATgB,CAUjB;AACA;AACA;AACA;AAEC;;;AACAd,IAAAA,CAAC,CAAC+C,IAAF,CAAO;AACNC,MAAAA,GAAG,EAAC,sCADE;AAENC,MAAAA,MAAM,EAAC,KAFD;AAGNC,MAAAA,SAAS,EAAE;AACTC,QAAAA,eAAe,EAAE;AADR,OAHL;AAMNC,MAAAA,OAAO,EAAE,UAASC,KAAT,EAAe;AACpB,YAAIA,KAAK,CAACC,OAAN,KAAkB,gBAAtB,EAAuC;AACnCC,UAAAA,KAAK,CAAC,SAAD,CAAL;AACH,SAHmB,CAIpB;AACA;AACA;;;AACA,aAAK,IAAIC,CAAT,IAAcH,KAAK,CAACI,IAApB,EAAyB;AACrB,cAAGJ,KAAK,CAACI,IAAN,CAAWD,CAAX,EAAcE,WAAd,IAA6B,YAAhC,EAA6C;AAC7C,iBAAKlB,QAAL,CAAc;AACVmB,cAAAA,SAAS,EAAE,KAAKjD,KAAL,CAAWiD,SAAX,CAAqBC,MAArB,CAA4B;AAAC,0BAAUP,KAAK,CAACI,IAAN,CAAWD,CAAX,EAAcK,MAAzB;AAAiC,0BAAUR,KAAK,CAACI,IAAN,CAAWD,CAAX,EAAc5C,MAAzD;AAAiE,4BAAYyC,KAAK,CAACI,IAAN,CAAWD,CAAX,EAAcM,QAA3F;AACvC,8BAAcT,KAAK,CAACI,IAAN,CAAWD,CAAX,EAAcO,UADW;AACC,+BAAeV,KAAK,CAACI,IAAN,CAAWD,CAAX,EAAcQ,WAD9B;AAEvC,+BAAeX,KAAK,CAACI,IAAN,CAAWD,CAAX,EAAcE,WAFU;AAEG,6BAAaL,KAAK,CAACI,IAAN,CAAWD,CAAX,EAAcS,SAF9B;AAEyC,6BAAaZ,KAAK,CAACI,IAAN,CAAWD,CAAX,EAAcU;AAFpE,eAA5B;AADD,aAAd;AAKC;AACJ;AACJ,OAhBQ,CAgBP9C,IAhBO,CAgBF,IAhBE,CANH;AAuBN+C,MAAAA,KAAK,EAAE,UAAUC,GAAV,EAAeC,WAAf,EAA4BC,WAA5B,EAAyC;AAC9Cf,QAAAA,KAAK,CAACa,GAAG,CAACG,MAAL,CAAL;AACAhB,QAAAA,KAAK,CAACe,WAAD,CAAL;AACD;AA1BK,KAAP;AA6BHE,IAAAA,UAAU,CAAC,YAAW;AAClB;AACA;AACA;AAEA,WAAK9D,KAAL,CAAW+D,SAAX,CAAqBC,GAArB,CAAyB,CAACC,KAAD,EAAQC,KAAR,KAAkB;AACvC,aAAKlE,KAAL,CAAWiD,SAAX,CAAqBe,GAArB,CAAyB,CAACjB,IAAD,EAAOD,CAAP,KAAa;AAClC,cAAGC,IAAI,CAACO,WAAL,KAAqBW,KAAK,CAACX,WAA9B,EAA0C;AACtC,gBAAIa,KAAK,GAAG,CAAC,GAAG,KAAKnE,KAAL,CAAW+D,SAAf,CAAZ;AACA,gBAAIK,IAAI,GAAG,EAAC,GAAGD,KAAK,CAACD,KAAD;AAAT,aAAX;AACAE,YAAAA,IAAI,CAACZ,SAAL,GAAiBY,IAAI,CAACZ,SAAL,GAAiBT,IAAI,CAACS,SAAvC;AACAY,YAAAA,IAAI,CAACC,WAAL,GAAmBD,IAAI,CAACC,WAAL,CAAiBnB,MAAjB,CAAwBH,IAAI,CAACI,MAA7B,CAAnB;AACAgB,YAAAA,KAAK,CAACD,KAAD,CAAL,GAAeE,IAAf;AACA,iBAAKtC,QAAL,CAAc;AAACiC,cAAAA,SAAS,EAAEI;AAAZ,aAAd;AACH;AACJ,SATD;AAUH,OAXD;AAaA,WAAKnE,KAAL,CAAW+D,SAAX,CAAqBC,GAArB,CAAyB,CAACC,KAAD,EAAQC,KAAR,KAAkB;AAEvC,YAAGD,KAAK,CAACK,MAAN,IAAgBL,KAAK,CAACT,SAAzB,EAAmC;AAC/B;AACA,cAAIW,KAAK,GAAG,CAAC,GAAG,KAAKnE,KAAL,CAAW+D,SAAf,CAAZ;AACA,cAAIK,IAAI,GAAG,EAAC,GAAGD,KAAK,CAACD,KAAD;AAAT,WAAX;AACAE,UAAAA,IAAI,CAACG,MAAL,GAAc,IAAd;AACAJ,UAAAA,KAAK,CAACD,KAAD,CAAL,GAAeE,IAAf;AACA,eAAKtC,QAAL,CAAc;AAACiC,YAAAA,SAAS,EAAEI;AAAZ,WAAd;AACH;AACJ,OAVD;AAYA,WAAKnE,KAAL,CAAW+D,SAAX,CAAqBC,GAArB,CAAyB,CAACC,KAAD,EAAQC,KAAR,KAAkB;AACvC,YAAIC,KAAK,GAAG,CAAC,GAAG,KAAKnE,KAAL,CAAW+D,SAAf,CAAZ;AACA,YAAIK,IAAI,GAAG,EAAC,GAAGD,KAAK,CAACD,KAAD;AAAT,SAAX;;AACA,YAAGD,KAAK,CAACM,MAAN,KAAiB,IAApB,EAAyB;AACrBH,UAAAA,IAAI,CAACI,UAAL,GAAkB,KAAlB;AACH,SAFD,MAGK,IAAGP,KAAK,CAACM,MAAN,KAAiB,IAAjB,IAAyBN,KAAK,CAACT,SAAN,GAAkB,CAA9C,EAAgD;AACjDY,UAAAA,IAAI,CAACI,UAAL,GAAkB,QAAlB;AACH,SAFI,MAGD;AACAJ,UAAAA,IAAI,CAACI,UAAL,GAAkB,WAAlB;AACH;;AACDL,QAAAA,KAAK,CAACD,KAAD,CAAL,GAAeE,IAAf;AACA,aAAKtC,QAAL,CAAc;AAACiC,UAAAA,SAAS,EAAEI;AAAZ,SAAd,EAbuC,CAcvC;;AAGA,YAAGF,KAAK,CAACI,WAAN,IAAqBJ,KAAK,CAACI,WAAN,CAAkBI,MAAlB,GAA2B,CAAnD,EAAqD,CACjD;AACA;AACH;AACJ,OArBD;AAwBH,KAtDU,CAsDT/D,IAtDS,CAsDJ,IAtDI,CAAD,EAsDI,GAtDJ,CAAV;AAuDC;;AAED0B,EAAAA,WAAW,CAACD,OAAD,EAAU/B,QAAV,EAAmB;AAC5B,QAAIkC,GAAG,GAAG,6BAAV;AACA,QAAIoC,QAAQ,GAAG;AAAC,kBAAYvC,OAAb;AAAsB,kBAAY/B;AAAlC,KAAf;AACAd,IAAAA,CAAC,CAAC+C,IAAF,CAAO;AACLC,MAAAA,GAAG,EAAEA,GADA;AAELC,MAAAA,MAAM,EAAE,MAFH;AAGLoC,MAAAA,IAAI,EAAED,QAHD;AAILlC,MAAAA,SAAS,EAAE;AACTC,QAAAA,eAAe,EAAE;AADR,OAJN;AAOLC,MAAAA,OAAO,EAAC,UAASiC,IAAT,EAAc;AACpB,YAAIA,IAAI,CAAC/B,OAAL,KAAiB,gBAArB,EAAsC;AACpC,eAAKd,QAAL,CAAc,EAAd;AAGD,SAJD,MAIM;AACJ,eAAKA,QAAL,CAAc;AACZ5B,YAAAA,MAAM,EAAE,EADI;AAEZC,YAAAA,QAAQ,EAAE,EAFE;AAGZC,YAAAA,QAAQ,EAAE,EAHE;AAIZH,YAAAA,UAAU,EAAE,KAJA;AAKZI,YAAAA,UAAU,EAAE;AALA,WAAd;AAOD;AACF,OAdO,CAcNK,IAdM,CAcD,IAdC,CAPH;AAsBL+C,MAAAA,KAAK,EAAC,UAAUC,GAAV,EAAeC,WAAf,EAA4BC,WAA5B,EAAyC;AAC7Cf,QAAAA,KAAK,CAACa,GAAG,CAACG,MAAL,CAAL;AACAhB,QAAAA,KAAK,CAACe,WAAD,CAAL;AACD;AAzBI,KAAP;AA2BD;;AAEDhD,EAAAA,UAAU,CAACgE,CAAD,EAAI;AACZ,QAAI,KAAK5E,KAAL,CAAWG,QAAX,KAAwB,EAAxB,IAA8B,KAAKH,KAAL,CAAWI,QAAX,KAAwB,EAA1D,EAA8D;AAC5D;AACA,WAAK0B,QAAL,CAAc;AACZzB,QAAAA,UAAU,EAAE;AADA,OAAd;AAGD,KALD,MAMI;AACF4B,MAAAA,YAAY,CAAC4C,OAAb,CAAqB,SAArB,EAAgC,KAAK7E,KAAL,CAAWG,QAA3C;AACA8B,MAAAA,YAAY,CAAC4C,OAAb,CAAqB,UAArB,EAAiC,KAAK7E,KAAL,CAAWI,QAA5C;AAEA,UAAI0E,SAAS,GAAG;AACd,oBAAa,KAAK9E,KAAL,CAAWG,QADV;AAEd,oBAAa,KAAKH,KAAL,CAAWI;AAFV,OAAhB;AAKAd,MAAAA,CAAC,CAAC+C,IAAF,CAAO;AACLC,QAAAA,GAAG,EAAE,6BADA;AAELyC,QAAAA,IAAI,EAAE,MAFD;AAGLJ,QAAAA,IAAI,EAAEG,SAHD;AAILtC,QAAAA,SAAS,EAAE;AAAEC,UAAAA,eAAe,EAAE;AAAnB,SAJN;AAKL;AACAC,QAAAA,OAAO,EAAE,UAASiC,IAAT,EAAe;AACtB,cAAIA,IAAI,CAAC/B,OAAL,KAAiB,gBAArB,EAAsC;AACpCX,YAAAA,YAAY,CAAC4C,OAAb,CAAqB,QAArB,EAA8B,MAA9B;AACA5C,YAAAA,YAAY,CAAC4C,OAAb,CAAqB,UAArB,EAAgCF,IAAI,CAACnE,QAArC;AACAyB,YAAAA,YAAY,CAAC4C,OAAb,CAAqB,QAArB,EAA8BF,IAAI,CAACK,EAAnC,EAHoC,CAIpC;;AAEA,iBAAKlD,QAAL,CAAc;AACZ7B,cAAAA,UAAU,EAAE,IADA;AAEZI,cAAAA,UAAU,EAAE,UAFA;AAGZG,cAAAA,QAAQ,EAAEmE,IAAI,CAACnE,QAHH;AAIZN,cAAAA,MAAM,EAAE+B,YAAY,CAAC/B;AAJT,aAAd;AAMD,WAZD,MAYM;AACJ,iBAAK4B,QAAL,CAAc;AACZ3B,cAAAA,QAAQ,EAAE,EADE;AAEZC,cAAAA,QAAQ,EAAE,EAFE;AAGZH,cAAAA,UAAU,EAAE,KAHA;AAIZI,cAAAA,UAAU,EAAE,eAJA;AAKZH,cAAAA,MAAM,EAAE;AALI,aAAd;AAOD;AACF,SAtBQ,CAsBPQ,IAtBO,CAsBF,IAtBE,CANJ;AA6BH+C,QAAAA,KAAK,EAAE,UAAUC,GAAV,EAAeC,WAAf,EAA4BC,WAA5B,EAAyC;AAC9Cf,UAAAA,KAAK,CAACa,GAAG,CAACG,MAAL,CAAL;AACAhB,UAAAA,KAAK,CAACe,WAAD,CAAL;AACD;AAhCE,OAAP;AAmCH;;AAEDgB,IAAAA,CAAC,CAACK,cAAF,CAAiBL,CAAjB;AACC;;AAED/D,EAAAA,WAAW,GAAE;AACXvB,IAAAA,CAAC,CAAC+C,IAAF,CAAO;AACLC,MAAAA,GAAG,EAAC,8BADC;AAELC,MAAAA,MAAM,EAAC,KAFF;AAGLC,MAAAA,SAAS,EAAE;AACTC,QAAAA,eAAe,EAAE;AADR,OAHN;AAMLC,MAAAA,OAAO,EAAE,UAASiC,IAAT,EAAc;AACrB;AACA1C,QAAAA,YAAY,CAAC4C,OAAb,CAAqB,QAArB,EAA8B,OAA9B;AACA5C,QAAAA,YAAY,CAAC4C,OAAb,CAAqB,SAArB,EAA+B,EAA/B;AACA5C,QAAAA,YAAY,CAAC4C,OAAb,CAAqB,UAArB,EAAgC,EAAhC,EAJqB,CAKrB;AACA;;AACA,aAAK/C,QAAL,CAAc;AACZ3B,UAAAA,QAAQ,EAAE,EADE;AAEZC,UAAAA,QAAQ,EAAE,EAFE;AAGZH,UAAAA,UAAU,EAAE,KAHA;AAIZI,UAAAA,UAAU,EAAE;AAJA,SAAd;AAMD,OAbQ,CAaPK,IAbO,CAaF,IAbE,CANJ;AAoBL+C,MAAAA,KAAK,EAAE,UAAUC,GAAV,EAAeC,WAAf,EAA4BC,WAA5B,EAAyC;AAC9Cf,QAAAA,KAAK,CAACa,GAAG,CAACG,MAAL,CAAL;AACAhB,QAAAA,KAAK,CAACe,WAAD,CAAL;AACD;AAvBI,KAAP;AAyBD;;AAED9C,EAAAA,UAAU,CAAC8D,CAAD,EAAG;AACX,SAAK9C,QAAL,CAAc;AACV;AACAvB,MAAAA,eAAe,EAAE,oBAAC,SAAD,CACW;AADX;AAEW,QAAA,UAAU,EAAI,KAAKQ,UAF9B;AAGW,QAAA,QAAQ,EAAI,IAHvB,CAIW;AACA;AALX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFP,KAAd;AAUD;;AAEDA,EAAAA,UAAU,CAAC6D,CAAD,EAAID,IAAJ,EAAS;AACjB,QAAIrB,WAAW,GAAG,EAAlB;AACA,QAAGqB,IAAI,CAAC,CAAD,CAAJ,IAAW,GAAd,EACErB,WAAW,GAAG,IAAd,CADF,KAGEA,WAAW,GAAGqB,IAAI,CAAC,CAAD,CAAlB;;AACF,QAAGA,IAAI,CAAC,CAAD,CAAJ,IAAW,CAAd,EAAgB;AACd,WAAK7C,QAAL,CAAc;AACZvB,QAAAA,eAAe,EAAE,oBAAC,IAAD;AAAM,UAAA,cAAc,EAAI,KAAKW,cAA7B,CACK;AACA;AAFL;AAGK,UAAA,eAAe,EAAI,KAAKC,eAH7B,CAIK;AAJL;AAKK,UAAA,WAAW,EAAImC,WALpB;AAMK,UAAA,MAAM,EAAE,KAAKtD,KAAL,CAAWE,MANxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADL,CASZ;;AATY,OAAd;AAWD,KAZD,MAaK,IAAIyE,IAAI,CAAC,CAAD,CAAJ,IAAW,CAAf,EAAiB;AACpB,WAAK7C,QAAL,CAAc;AACZvB,QAAAA,eAAe,EAAE,oBAAC,KAAD;AAAO,UAAA,cAAc,EAAI,KAAKW,cAA9B;AACO,UAAA,QAAQ,EAAI,KAAKE,QADxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADL,OAAd;AAKD;AAEF;;AAEDJ,EAAAA,aAAa,CAAC4D,CAAD,EAAG;AACd,SAAK9C,QAAL,CAAc;AACV;AACAvB,MAAAA,eAAe,EAAE,oBAAC,SAAD;AACW,QAAA,UAAU,EAAI,KAAKQ,UAD9B;AAEW,QAAA,QAAQ,EAAI,IAFvB,CAGW;AACA;AAJX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFP,CAQV;;AARU,KAAd;AAUD;;AAEDE,EAAAA,aAAa,CAAC2D,CAAD,EAAG;AACd,QAAG,KAAK5E,KAAL,CAAWQ,QAAX,IAAuB,SAA1B,EAAoC;AAClC,WAAKsB,QAAL,CAAc;AACZvB,QAAAA,eAAe,EAAE;AADL,OAAd;AAGD,KAJD,MAKI;AACFsC,MAAAA,KAAK,CAAC,mBAAD,CAAL,CADE,CAEF;AACA;AACF;AACA;AACA;AACA;AACA;;AACA,aAAO,oBAAC,QAAD;AAAU,QAAA,EAAE,EAAC,OAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAP,CATI,CAUF;AACF;AAGE;AAEH;AACA;;AAED3B,EAAAA,cAAc,CAAC0D,CAAD,EAAID,IAAJ,EAAS;AACrB;AACA,QAAGA,IAAI,CAAC,CAAD,CAAJ,IAAW,CAAd,EACE,KAAK7C,QAAL,CAAc;AACZvB,MAAAA,eAAe,EAAE,oBAAC,SAAD;AACW,QAAA,UAAU,EAAI,KAAKQ,UAD9B;AAEW,QAAA,QAAQ,EAAI,KAFvB;AAGW,QAAA,SAAS,EAAE,KAAKf,KAAL,CAAW+D,SAHjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADL,KAAd,EADF,KAUA,KAAKjC,QAAL,CAAc;AACZvB,MAAAA,eAAe,EAAE,oBAAC,SAAD;AACW,QAAA,UAAU,EAAI,KAAKQ,UAD9B;AAEW,QAAA,QAAQ,EAAI,IAFvB;AAGW,QAAA,SAAS,EAAE,KAAKf,KAAL,CAAW+D,SAHjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADL,KAAd;AAQD;;AAED5C,EAAAA,eAAe,CAACyD,CAAD,EAAID,IAAJ,EAAS;AACtB;AACA;AACE,SAAK7C,QAAL,CAAc;AACZvB,MAAAA,eAAe,EAAE;AADL,KAAd,EAHoB,CAMpB;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACE;AACF;AAGF;AACD;;AAEDa,EAAAA,QAAQ,CAACwD,CAAD,EAAG;AACT,SAAK9C,QAAL,CAAc;AACVvB,MAAAA,eAAe,EAAE;AADP,KAAd;AAGD;;AA/e8B;;AAsfjC,eAAeX,GAAf","sourcesContent":["// import React from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n// import Content from './Content';\n// import Try from './notused/Try';\nimport Login from './Login';\nimport TableList from './Table';\nimport Menu from './Menu';\nimport Bills from './Bills';\nimport Home from './Home';\nimport { withRouter } from 'react-router-dom';\nimport React, { useState, useEffect } from 'react';\nimport { Redirect } from 'react-router-dom'\n// import { BrowserRouter as Router, Route } from 'react-router-dom';\n\n// import logic from './logic';\nimport '../node_modules/bootstrap/dist/css/bootstrap.min.css';\nimport $ from 'jquery';\nimport { BrowserRouter as Router, Switch, Route, Link } from \"react-router-dom\";\n\n// function requireAuth(nextState, replace, next) {\n//   if (!this.state.isLoggedIn) {\n//     replace({\n//       pathname: \"/login\",\n//       state: {nextPathname: nextState.location.pathname}\n//     });\n//   }\n//   next();\n// }\n\n\nclass App extends React.Component{\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isLoggedIn: false,\n      userId: '',\n      username: '',\n      password: '',\n      login_fail: 'WELCOME!',\n      user_type: '',\n      active_function: '',\n      position: '',\n      // transinfo: [],\n      // tableinfo: [],\n    };\n    this.usernameChange = this.usernameChange.bind(this);\n    this.passwordChange = this.passwordChange.bind(this);\n    this.LoginClick = this.LoginClick.bind(this);\n    this.LogoutClick = this.LogoutClick.bind(this);\n    this.OrderClick = this.OrderClick.bind(this);\n    this.TableClick = this.TableClick.bind(this);\n    this.PaybillsClick = this.PaybillsClick.bind(this);\n    this.ForecastClick = this.ForecastClick.bind(this);\n    this.BackTableClick = this.BackTableClick.bind(this);\n    this.PlaceOrderClick = this.PlaceOrderClick.bind(this);\n    this.PayClick = this.PayClick.bind(this);\n  }\n\n  render(){\n    const isLoggedIn = this.state.isLoggedIn;\n    let title, current_page, login_page, menu_page, tablelist, nav, bills;\n    // let routes = '';\n\n    if (isLoggedIn) {\n      title = '';\n      nav = <div class=\"nav_bar\">\n              <h3 class=\"fas fa-home\"> SUN PO</h3>\n              <ul>\n                <li><div class=\"fas fa-user\"> {this.state.username}</div></li>\n                {/* <li tabindex=\"1\"></li> */}\n                <li onClick={this.OrderClick}><a class=\"function_btn fas fa-shopping-bag\">點餐</a></li>\n                {/* <Link to=\"/order\"><li onClick={this.OrderClick}><a class=\"function_btn fas fa-shopping-bag\">點餐</a></li></Link> */}\n                <li onClick={this.PaybillsClick}><a class=\"function_btn fas fa-money-bill-wave\"> 查閱/結賬</a></li>\n                <li onClick={this.ForecastClick}><a class=\"function_btn fas fa-atom\"> 銷量預測</a></li>\n                <li onClick={this.LogoutClick}><a class=\"function_btn fas fa-power-off\"> 登出</a></li>\n              </ul>\n            </div>\n      menu_page = <Menu/>\n      bills = <Bills/>\n        // tablelist = <TableList\n        // TableClick = {this.TableClick}\n        //                             payBills = {false}\n        //                             tableinfo={this.state.tableinfo}/>\n        tablelist = <div>{this.state.active_function}</div>\n\n      // routes = \n      //   <Router>\n      //   <Switch>\n      //               <Route path=\"/home\">\n      //                 <Home/>\n      //               </Route>\n      //               <Route path=\"/login\">\n      //                 <Home/>\n      //               </Route>\n      //               <Route path=\"/order\" onEnter={this.requireAuth}  >\n      //               <TableList \n      //                               // active_function={this.state.active_Function}\n      //                               TableClick = {this.TableClick}\n      //                               payBills = {false}\n      //                               tableinfo={this.state.tableinfo}\n      //                     />\n      //               </Route>\n                      \n      //               <Route path=\"/paybills\">\n      //               <TableList \n      //                               // active_function={this.state.active_Function}\n      //                               TableClick = {this.TableClick}\n      //                               payBills = {true}\n      //                               tableinfo={this.state.tableinfo}\n      //                     />\n      //               </Route>\n      //               <Route path=\"/forcast\">\n      //               </Route>\n      //                {/* <Route path=\"/menu\">\n      //               <Menu BackTableClick = {this.BackTableClick}\n      //                         PlaceOrderClick = {this.PlaceOrderClick}\n      //                         // tableNumber = {tableNumber}\n      //                         userId={this.state.userId}\n      //   />,\n      //               </Route>  */}\n      //            </Switch>  \n      //  </Router>   \n    }\n    else{\n      title = <div id=\"logo_title\">SUN PO</div>\n      login_page = <Login\n      username={this.state.username}\n      password={this.state.password}\n      // position={this.state.position}\n      onUsernameChange={this.usernameChange}\n      onPasswordChange={this.passwordChange}\n      LoginClick={this.LoginClick}\n      login_fail={this.state.login_fail}\n      />\n\n    }\n\n    return (\n      \n        /* <Link to=\"/login\">login</Link>\n       <Link to=\"/logout\">logout</Link> \n      <Link to=\"/order\">order</Link>\n      <Link to=\"/paybills\">paybills</Link>\n      <Link to=\"/forecast\">forecast</Link>\n    <Link exact to=\"/\">Home</Link>   */\n     <div className=\"App\">\n        {title}\n        {nav}\n        {login_page}\n        {/* {routes} */}\n        {tablelist}\n        {/* {menu_page} */}\n        {/* {bills} */}\n      </div>\n        \n    );\n  }\n  // requireAuth(nextState, replace)\n  // {\n  // if(!this.state.isLoggedIn) // pseudocode - SYNCHRONOUS function (cannot be async without extra callback parameter to this function)\n  // replace('/login');\n  // }\n\n  usernameChange(name) {\n    this.setState({\n      username: name\n    })\n  }\n\n  passwordChange(pass) {\n    this.setState({\n      password: pass\n    })\n  }\n\n  componentDidMount(){\n    if(localStorage.loggin === 'true'){\n      this.setState({\n        isLoggedIn: true,\n        username: localStorage.usrname,\n        position: localStorage.position,\n        userId: localStorage.userId,\n      });\n      this.pageRefresh(localStorage.usrname, localStorage.password);\n    }\n    // const script = document.createElement(\"script\");\n    // // script.async = true;\n    // script.src = \"https://kit.fontawesome.com/b99e675b6e.js\";\n    // document.head.appendChild(script);\n\n     //get transaction\n     $.ajax({\n      url:\"http://localhost:3001/gettransaction\",\n      method:\"GET\",\n      xhrFields: {\n        withCredentials: true\n      },\n      success: function(datas){\n          if (datas.message === \"Login Success!\"){\n              alert(\"success\");\n          }\n          // alert(datas.tran[0].products[0].name+\" \"+datas.tran[0].products[0].price+\" \"+datas.tran[0].products[0].originalPrice+\" \"+\n          // datas.tran[0].products[0].quantity+\" \"+datas.tran[0].products[0].custom[0]+\" \"+datas.tran[0].totalPrice+' '+\n          // datas.tran[0].tranId+\" \"+datas.tran[0].tableNumber+\" \"+datas.tran[0].transTime+\" \"+datas.tran[0].orderStatus+\" \"+datas.tran[0].seatTaken);\n          for (var i in datas.tran){\n              if(datas.tran[i].orderStatus == \"proceeding\"){\n              this.setState({\n                  transinfo: this.state.transinfo.concat({\"tranId\": datas.tran[i].tranId, \"userId\": datas.tran[i].userId, \"products\": datas.tran[i].products, \n                  \"totalPrice\": datas.tran[i].totalPrice, \"tableNumber\": datas.tran[i].tableNumber, \n                  \"orderStatus\": datas.tran[i].orderStatus, \"transTime\": datas.tran[i].transTime, \"seatTaken\": datas.tran[i].seatTaken,}),\n                });\n              }\n          }\n      }.bind(this),\n      error: function (xhr, ajaxOptions, thrownError) {\n        alert(xhr.status);\n        alert(thrownError);\n      }\n    });\n  \n  setTimeout(function() { \n      // this.state.transinfo[0].products.map((tran, index) => {\n      //     alert(tran.name+' '+tran.custom[0]);\n      // })\n\n      this.state.tableinfo.map((table, index) => {\n          this.state.transinfo.map((tran, i) => {\n              if(tran.tableNumber === table.tableNumber){\n                  let items = [...this.state.tableinfo];\n                  let item = {...items[index]};\n                  item.seatTaken = item.seatTaken + tran.seatTaken;\n                  item.transaction = item.transaction.concat(tran.tranId);\n                  items[index] = item;\n                  this.setState({tableinfo: items});\n              }\n          })\n      })\n\n      this.state.tableinfo.map((table, index) => {\n\n          if(table.maxCap <= table.seatTaken){\n              // alert(\"maxcap: \"+table.maxCap+\" seatTaken: \"+table.seatTaken);\n              let items = [...this.state.tableinfo];\n              let item = {...items[index]};\n              item.isFull = true;\n              items[index] = item;\n              this.setState({tableinfo: items});\n          }\n      })\n      \n      this.state.tableinfo.map((table, index) => {\n          let items = [...this.state.tableinfo];\n          let item = {...items[index]};\n          if(table.isFull === true){\n              item.tableColor = 'red';\n          }\n          else if(table.isFull !== true && table.seatTaken > 0){\n              item.tableColor = 'orange';\n          }\n          else{\n              item.tableColor = 'palegreen';\n          }\n          items[index] = item;\n          this.setState({tableinfo: items});\n          // alert(table.tableNumber+' '+table.tableColor);\n\n\n          if(table.transaction && table.transaction.length > 0){\n              // alert(\"Table \"+table.tableNumber + \" has transaction\");\n              // alert(table.transaction[0]);\n          }\n      }\n          \n      )\n  }.bind(this), 100)\n  }\n\n  pageRefresh(usrname, password){\n    var url = \"http://localhost:3001/login\";\n    var userinfo = {'username': usrname, 'password': password};\n    $.ajax({\n      url: url,\n      method: \"POST\",\n      data: userinfo,\n      xhrFields: {\n        withCredentials: true\n      },\n      success:function(data){\n        if (data.message === \"Login Success!\"){\n          this.setState({\n            \n          })\n        } else{\n          this.setState({\n            userId: '',\n            username: '',\n            password: '',\n            isLoggedIn: false,\n            login_fail: \"LOGIN FAILURE\"\n          })\n        }\n      }.bind(this),\n      error:function (xhr, ajaxOptions, thrownError) {\n        alert(xhr.status);\n        alert(thrownError);\n      }\n    });\n  }\n\n  LoginClick(e) {\n    if (this.state.username === '' || this.state.password === '') {\n      // alert('Please fill in all fields');\n      this.setState({\n        login_fail: 'PLEASE FILL IN ALL FIELDS!',\n      });\n    }\n    else{\n      localStorage.setItem('usrname', this.state.username);\n      localStorage.setItem('password', this.state.password);\n\n      var loginInfo = {\n        \"username\" : this.state.username,\n        \"password\" : this.state.password,\n      }\n\n      $.ajax({\n        url: \"http://localhost:3001/login\",\n        type: 'POST',\n        data: loginInfo,\n        xhrFields: { withCredentials: true },\n        // dataType: 'JSON',\n        success: function(data) {\n          if (data.message === \"Login Success!\"){\n            localStorage.setItem('loggin','true');\n            localStorage.setItem('position',data.position);\n            localStorage.setItem('userId',data.id);\n            // alert(data.id);\n\n            this.setState({\n              isLoggedIn: true,\n              login_fail: 'WELCOME!',\n              position: data.position,\n              userId: localStorage.userId,\n            });\n          } else{\n            this.setState({\n              username: '',\n              password: '',\n              isLoggedIn: false,\n              login_fail: \"LOGIN FAILURE\",\n              userId: '',\n            });\n          }\n        }.bind(this),\n          error: function (xhr, ajaxOptions, thrownError) {\n            alert(xhr.status);\n            alert(thrownError);\n          }\n      });\n\n  }\n\n  e.preventDefault(e);\n  }\n\n  LogoutClick(){\n    $.ajax({\n      url:\"http://localhost:3001/logout\",\n      method:\"GET\",\n      xhrFields: {\n        withCredentials: true\n      },\n      success: function(data){\n        // clear stored user state after logout\n        localStorage.setItem('loggin','false');\n        localStorage.setItem('usrname','');\n        localStorage.setItem('password','');\n        // clear timer\n        // clearInterval(this.timerID);\n        this.setState({\n          username: '',\n          password: '',\n          isLoggedIn: false,\n          login_fail: \"SUCCESSFULLY LOGOUT!\",\n        });\n      }.bind(this),\n      error: function (xhr, ajaxOptions, thrownError) {\n        alert(xhr.status);\n        alert(thrownError);\n      }\n    });\n  }\n\n  OrderClick(e){\n    this.setState({\n        // payBills: false,\n        active_function: <TableList \n                                    // active_function={this.state.active_Function}\n                                    TableClick = {this.TableClick}\n                                    payBills = {'點餐'}\n                                    // tableinfo={this.state.tableinfo}\n                                    // tableNumber={this.state.tableNumber}\n                          />,\n      })\n  }\n\n  TableClick(e, data){\n    let tableNumber = '';\n    if(data[2] == '0')\n      tableNumber = '10';\n    else\n      tableNumber = data[1];\n    if(data[0] == 1){\n      this.setState({\n        active_function: <Menu BackTableClick = {this.BackTableClick}\n                              // AddFoodClick = {this.AddFoodClick}\n                              // AddBtnClick = {this.AddBtnClick}\n                              PlaceOrderClick = {this.PlaceOrderClick}\n                              // addedList={this.state.addedList}\n                              tableNumber = {tableNumber}\n                              userId={this.state.userId}\n        />,\n        // active_function: '',\n      })\n    }\n    else if (data[0] == 2){\n      this.setState({\n        active_function: <Bills BackTableClick = {this.BackTableClick}\n                                PayClick = {this.PayClick}\n                          />,\n      })\n    }\n    \n  }\n\n  PaybillsClick(e){\n    this.setState({\n        // payBills: true,\n        active_function: <TableList \n                                    TableClick = {this.TableClick}\n                                    payBills = {'結賬'}\n                                    // tableinfo={this.state.tableinfo}\n                                    // tableNumber={this.state.tableNumber}\n        />,\n        // active_function: <Menu/>,\n      })\n  }\n\n  ForecastClick(e){\n    if(this.state.position == \"manager\"){\n      this.setState({\n        active_function: '',\n      })\n    }\n    else{\n      alert(\"Permitted Action!\");\n      // this.props.history.push('/home/');\n      // return(\n    //   <Redirect to={{\n    //     pathname: '/home',\n    //     // state: { id: '123' }\n    // }} />\n    //   <Route>\n    return <Redirect to='/home' />\n      // <Redirect path=\"/home\" />\n    // </Route>\n    \n    \n      // )\n    \n  }\n  }\n\n  BackTableClick(e, data){\n    // alert(data[0]);\n    if(data[0] == 1)\n      this.setState({\n        active_function: <TableList \n                                    TableClick = {this.TableClick}\n                                    payBills = {false}\n                                    tableinfo={this.state.tableinfo}\n\n        />,\n      })\n    else\n    this.setState({\n      active_function: <TableList \n                                  TableClick = {this.TableClick}\n                                  payBills = {true}\n                                  tableinfo={this.state.tableinfo}\n\n      />,\n    })\n  }\n\n  PlaceOrderClick(e, data){\n    // var confirmation = window.confirm('你確定要落單?');\n    // if(confirmation === true){\n      this.setState({\n        active_function: '',\n      })\n      // var a = e.target.id;\n      // alert(a);\n      // alert(\"place: \" +data);\n\n      // data.map(item => {\n      //   alert(item.name + \": $\"+item.price+\" quantity: \"+item.quantity+\" totalPrice: \"+item.totalPrice+\n      //   \" tableNumber: \"+item.tableNumber+\" transTime: \"+item.transTime+\" People: \"+item.seatTaken+\n      //   \" id: \"+item.id+\" custom: \")\n\n      //   item.custom.map(items => {\n      //     // alert(item.name + \": $\"+item.price+\" quantity: \"+item.quantity+\"custom: \"+items)\n      // alert(item.totalPrice+' '+item.tableNumber+' '+item.transTime+' '+item.orderStatus);\n        // })\n      // })\n\n\n    // }\n  }\n\n  PayClick(e){\n    this.setState({\n        active_function: '',\n      })\n  }\n\n}\n\n\n\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}